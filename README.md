# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.

## How the System Works (Step-by-Step Explanation)

This backend system operates through a series of interconnected components to deliver movie recommendations and related data:

1.  **Data Generation (`generate_data.py`):**
    *   **Purpose:** This script is the backbone for preparing all the necessary data for the recommendation engine.
    *   **Process:**
        *   It fetches raw movie data (e.g., titles, genres, overviews, release dates, poster paths) from the TMDB (The Movie Database) API.
        *   It cleans and preprocesses this raw data, handling missing values and formatting genres and dates.
        *   It uses a pre-trained **SentenceTransformer model (`msmarco-MiniLM-L6-cos-v5`)** to generate high-dimensional numerical *embeddings* for each movie's textual features (like overview and genres). These embeddings capture the semantic meaning of the movie's content.
        *   It calculates a **cosine similarity matrix** based on these embeddings, which quantifies how similar any two movies are to each other.
        *   Finally, it saves the processed movie data, similarity matrix, and embeddings into `.pkl` and `.npy` files (`movie_data_api.pkl`, `movie_embeddings.npy`, `movie_clusters.npy`) in the `data/` directory. These files are crucial as they are loaded by the Flask application.

2.  **Recommendation Logic (`backend/recommender.py`):**
    *   **Purpose:** This module encapsulates the core recommendation algorithm.
    *   **Process:**
        *   It loads the `movie_data_api.pkl`, `movie_embeddings.npy`, and `movie_clusters.npy` files generated by `generate_data.py`.
        *   The `get_recommendations` function takes a movie title (or an internal movie ID), along with optional filters (like `top_n`, `min_year`, `max_year`, `genres`).
        *   It identifies the closest matching movie in the dataset.
        *   It then uses the pre-calculated **cosine similarity matrix** (and potentially a clustering approach for diversity) to find movies most similar to the input movie.
        *   It applies any specified year or genre filters to the recommended movies.
        *   It returns a list of recommended movie objects, each containing comprehensive details (ID, title, release date, genres, overview, poster path).
    *   **Title Suggestion:** It also includes logic for suggesting movie titles based on a partial query, assisting with user input.

3.  **Flask Backend (`backend/main.py`):**
    *   **Purpose:** This is the main Flask application that exposes the API endpoints to the frontend.
    *   **Process:**
        *   It initializes the Flask application and enables **CORS (Cross-Origin Resource Sharing)** to allow requests from different origins (e.g., a frontend application hosted on a different domain).
        *   Upon startup, it calls a `load_data()` function which loads the `movie_data_api.pkl`, `movie_embeddings.npy`, and `movie_clusters.npy` files into memory. This makes the data readily available for rapid responses to API requests.
        *   It defines various **API routes (endpoints)**, each mapped to a specific function that handles incoming HTTP requests (GET).
        *   For recommendation requests (`/recommend` and `/api/recommendations/<int:movie_id>`), it calls the `recommender` module's functions to get the results.
        *   For data retrieval requests (`/api/movies`, `/api/movies/<int:movie_id>`, `/genres`, `/years`, `/api/search`), it directly queries the loaded `movie_data` DataFrame.
        *   All responses are formatted as **JSON** for easy consumption by web or mobile applications.

4.  **Deployment (Render):**
    *   **Purpose:** The backend is designed to be deployed on platforms like Render.
    *   **Process:**
        *   Render is configured to automatically build and deploy the service when changes are pushed to the connected GitHub repository.
        *   The `requirements.txt` ensures all Python dependencies are installed.
        *   The **Build Command (`pip install -r requirements.txt && python generate_data.py`)** is crucial. It ensures that the `generate_data.py` script runs during the build process on Render, creating the necessary `.pkl` and `.npy` data files directly on the server's file system *before* the Flask application starts. This avoids committing large binary files to Git and solves LFS quota issues.
        *   The **Start Command (`gunicorn backend.main:app --bind 0.0.0.0:$PORT --timeout 120`)** launches the Flask application using Gunicorn, a production-ready WSGI server, making it robust and performant.

## Backend API Endpoints

This section details the RESTful API endpoints provided by the Flask backend. Please note that the `get_movie_details` endpoint is currently still registered alongside `get_movie`, despite the intention to consolidate.

### Base URL: `https://movie-recommender-skvv.onrender.com`

---

### 1. Root Endpoint: `/`
- **Method:** `GET`
- **Purpose:** Health check to confirm the backend is running.
- **How it works:** When you hit this endpoint, your Flask application returns a basic JSON message, indicating that the server is active and accessible.
- **Postman Test:**
    - **URL:** `https://movie-recommender-skvv.onrender.com/`
    - **Method:** `GET`
    - **Expected Response (JSON):**
    ```json
    {
        "message": "Movie Recommendation API is running!"
    }
    ```

---

### 2. Movie Recommendations by Title: `/recommend`
- **Method:** `GET`
- **Purpose:** Provides a list of movie recommendations based on a given title, with optional filters. This endpoint uses the enhanced recommendation logic from `recommender.py` to provide rich movie details.
- **How it works:**
    1.  The backend receives a movie title and optional filters.
    2.  It uses the `recommender.py` module to find the closest matching movie in your dataset.
    3.  Based on this matched movie, it generates a list of recommended movies using a multi-feature similarity (text, genre, year) and diversity algorithm.
    4.  Crucially, it returns comprehensive details for each recommended movie (ID, title, release date, genres, overview, poster path).
- **Query Parameters:**
    - `title` (required): The exact or partial title of the movie. (e.g., `Inception`)
    - `top_n` (optional, default: 10): Number of recommendations to return. (e.g., `5`)
    - `min_year` (optional): Minimum release year for recommendations. (e.g., `2010`)
    - `max_year` (optional): Maximum release year for recommendations. (e.g., `2020`)
    - `genres` (optional): A JSON string of a list of genres to filter by. (e.g., `["Action", "Sci-Fi"]` - *Note: Ensure proper URL encoding if testing directly in browser or some tools.*)
- **Postman Test Examples:**
    - **URL:** `https://movie-recommender-skvv.onrender.com/recommend?title=Inception`
    - **URL (with filters):** `https://movie-recommender-skvv.onrender.com/recommend?title=Avatar&top_n=5&min_year=2000&genres=["Action"]`
    - **Method:** `GET`
    - **Expected Response (JSON):** A JSON object containing a `recommendations` list (each item being a detailed movie object) and a `matched_title`.
    ```json
    {
        "recommendations": [
            {
                "id": 12345,
                "title": "Example Movie 1",
                "release_date": "2012",
                "genres": ["Action", "Sci-Fi"],
                "overview": "...",
                "poster_path": "/path/to/poster1.jpg"
            },
            // ... more movie objects
        ],
        "matched_title": "Inception"
    }
    ```

---

### 3. Movie Suggestions: `/suggest`
- **Method:** `GET`
- **Purpose:** Provides movie title suggestions based on a partial query string, useful for autocomplete features.
- **How it works:** It takes a partial movie title query, searches your dataset for titles that are close matches, and returns them as a list of suggestions.
- **Query Parameter:**
    - `query` (required): The partial movie title. (e.g., `batman`)
- **Postman Test:**
    - **URL:** `https://movie-recommender-skvv.onrender.com/suggest?query=batman`
    - **Method:** `GET`
    - **Expected Response (JSON):**
    ```json
    {
        "suggestions": [
            "Batman Begins",
            "The Dark Knight",
            "The Dark Knight Rises",
            // ... more suggestions
        ]
    }
    ```

---

### 4. Get All Genres: `/genres`
- **Method:** `GET`
- **Purpose:** Returns a list of all unique movie genres available in your dataset.
- **How it works:** It dynamically extracts all unique genres from your loaded movie data, making it useful for populating genre filter options in a frontend.
- **Postman Test:**
    - **URL:** `https://movie-recommender-skvv.onrender.com/genres`
    - **Method:** `GET`
    - **Expected Response (JSON):**
    ```json
    {
        "genres": [
            "Action",
            "Adventure",
            "Animation",
            // ... more genres
        ]
    }
    ```

---

### 5. Get All Years: `/years`
- **Method:** `GET`
- **Purpose:** Returns a list of all unique movie release years available in your dataset.
- **How it works:** Similar to `/genres`, this endpoint extracts all unique release years from your movie data.
- **Postman Test:**
    - **URL:** `https://movie-recommender-skvv.onrender.com/years`
    - **Method:** `GET`
    - **Expected Response (JSON):**
    ```json
    {
        "years": [
            1916,
            1925,
            1927,
            // ... more years
        ]
    }
    ```

---

### 6. Get Paginated Movies: `/api/movies`
- **Method:** `GET`
- **Purpose:** Returns a paginated list of movies from your dataset.
- **How it works:** This endpoint allows you to retrieve movies in chunks (pages), which is efficient for displaying large datasets without loading everything at once. You can control the `page` number and `per_page` (number of movies per page).
- **Query Parameters:**
    - `page` (optional, default: 1): The page number to retrieve. (e.g., `2`)
    - `per_page` (optional, default: 20): The number of movies per page. (e.g., `10`)
- **Postman Test Examples:**
    - **URL:** `https://movie-recommender-skvv.onrender.com/api/movies`
    - **URL (page 2, 5 movies per page):** `https://movie-recommender-skvv.onrender.com/api/movies?page=2&per_page=5`
    - **Method:** `GET`
    - **Expected Response (JSON):**
    ```json
    {
        "movies": [
            {
                "id": 123,
                "title": "Movie A",
                "release_date": "2000",
                "genres": ["Action"],
                // ... other movie details
            },
            // ... more movie objects
        ],
        "total": 4796, // Or whatever your total movies count is after generate_data.py
        "page": 1,
        "per_page": 20,
        "total_pages": 240 // Based on total movies
    }
    ```

---

### 7. Get Movie Details by ID: `/api/movies/<int:movie_id>`
- **Method:** `GET`
- **Purpose:** Returns comprehensive details for a specific movie using its unique ID. This endpoint is designed to provide all rich details.
- **How it works:** You provide a movie ID in the URL path, and the backend retrieves all available information for that specific movie, including genres, release year, overview, etc.
- **Path Parameter:**
    - `movie_id` (required): The unique integer ID of the movie. (e.g., `27205` for Inception)
- **Postman Test:**
    - **URL:** `https://movie-recommender-skvv.onrender.com/api/movies/27205` (Example for Inception)
    - **Method:** `GET`
    - **Expected Response (JSON):** A single movie object with all its detailed attributes.
    ```json
    {
        "id": 27205,
        "title": "Inception",
        "release_date": "2010",
        "genres": ["Action", "Science Fiction", "Adventure"],
        "overview": "A thief who steals corporate secrets...",
        "poster_path": "/path/to/inception_poster.jpg",
        // ... more details
    }
    ```

---

### 8. (Currently Duplicate) Get Movie Details by ID: `/api/movie/details/<int:movie_id>`
- **Method:** `GET`
- **Purpose:** This endpoint also returns comprehensive details for a specific movie by its ID. According to your `Flask URL Map`, this endpoint is still registered. While its functionality was intended to be merged into `/api/movies/<int:movie_id>`, it appears to be currently active.
- **How it works:** Similar to `/api/movies/<int:movie_id>`, it takes a movie ID and returns the detailed information for that movie.
- **Path Parameter:**
    - `movie_id` (required): The unique integer ID of the movie. (e.g., `27205`)
- **Postman Test:**
    - **URL:** `https://movie-recommender-skvv.onrender.com/api/movie/details/27205`
    - **Method:** `GET`
    - **Expected Response (JSON):** Similar to `/api/movies/<int:movie_id>`, a single movie object with detailed attributes.

---

### 9. Movie Recommendations by ID: `/api/recommendations/<int:movie_id>`
- **Method:** `GET`
- **Purpose:** Generates movie recommendations based on a given movie's ID, using the same high-quality recommendation logic as the `/recommend` endpoint.
- **How it works:**
    1.  The backend receives a movie ID.
    2.  It first finds the corresponding movie title using the ID.
    3.  Then, it calls the `recommender.get_recommendations` function (the same core logic used by `/recommend`) to generate the recommendations.
    4.  It returns a list of recommended movie objects with rich details.
- **Path Parameter:**
    - `movie_id` (required): The unique integer ID of the movie. (e.g., `27205` for Inception)
- **Query Parameter:**
    - `top_n` (optional, default: 10): Number of recommendations to return. (e.g., `5`)
- **Postman Test Examples:**
    - **URL:** `https://movie-recommender-skvv.onrender.com/api/recommendations/27205`
    - **URL (with top_n):** `https://movie-recommender-skvv.onrender.com/api/recommendations/27205?top_n=5`
    - **Method:** `GET`
    - **Expected Response (JSON):** A JSON object containing a `recommendations` list (each item being a detailed movie object) and a `matched_title`.
    ```json
    {
        "recommendations": [
            {
                "id": 12345,
                "title": "Example Recommended Movie 1",
                "release_date": "2011",
                "genres": ["Thriller"],
                // ... more details
            },
            // ... more movie objects
        ],
        "matched_title": "Inception"
    }
    ```

---

### 10. Search Movies: `/api/search`
- **Method:** `GET`
- **Purpose:** Searches for movies whose titles contain a given query string (case-insensitive).
- **How it works:** This endpoint performs a simple search on movie titles in your dataset, returning a list of matching movies. Results are limited to the first 20 to avoid overwhelming responses.
- **Query Parameter:**
    - `query` (required): The search string. (e.g., `star wars`)
- **Postman Test:**
    - **URL:** `https://movie-recommender-skvv.onrender.com/api/search?query=star wars`
    - **Method:** `GET`
    - **Expected Response (JSON):**
    ```json
    {
        "results": [
            {
                "id": 123,
                "title": "Star Wars: The Force Awakens",
                "release_date": "2015",
                "genres": ["Sci-Fi", "Adventure"],
                // ... other movie details
            },
            // ... more search results (up to 20)
        ]
    }
    ```
